直播源处理脚本详细说明

📋 项目概述

这是一个功能完整的直播源处理脚本，用于从多个网络源收集、整理、分类和去重电视直播频道数据，生成多种格式的输出文件供播放器使用。

🏗️ 系统架构

主要功能模块

1. 数据收集模块 - 从网络源获取直播数据
2. 数据处理模块 - 清洗、分类、去重频道数据
3. 输出生成模块 - 生成多种格式的输出文件
4. 监控统计模块 - 提供处理过程的可观测性

📁 目录结构

```
scripts/livesource/
├── blacklist/              # 黑名单目录
│   ├── blacklist_auto.txt     # 自动生成的黑名单
│   ├── blacklist_manual.txt   # 手工维护的黑名单
│   └── whitelist_auto.txt     # 白名单（高速源）
├── 主频道/                  # 主要频道分类字典
│   ├── CCTV.txt              # 央视频道
│   ├── 卫视频道.txt          # 卫视频道
│   └── ...其他分类
├── 地方台/                  # 地方频道字典
│   ├── 北京频道.txt
│   ├── 上海频道.txt
│   └── ...其他省份
├── 手工区/                  # 手工维护的高质量源
│   ├── 港澳台.txt
│   ├── 优质央视.txt
│   └── ...其他手工源
└── urls-daily.txt          # 每日更新的源URL列表

output/livesource/          # 输出目录
├── full.txt               # 完整版
├── lite.txt               # 精简版  
├── custom.txt             # 定制版
├── others.txt             # 其他源
└── 对应的.m3u文件
```

🔧 核心功能详解

1. 数据收集与处理

网络请求机制

```python
def get_http_response(url, timeout=10, retries=3, backoff_factor=1.5):
```

· 智能重试: 指数退避算法，避免请求过快被封锁
· 超时控制: 10秒超时，保证处理效率
· 错误处理: 区分HTTP错误、网络错误、超时等不同情况
· 用户代理: 模拟真实浏览器请求，避免被屏蔽

URL源处理

· 动态日期替换: 自动处理{MMdd}、{MMdd-1}等日期变量
· 格式自动识别: 智能识别M3U格式并自动转换为TXT
· 多源加速: 支持#分隔的多个URL加速源

2. 频道数据处理

名称标准化

```python
def clean_channel_name(channel_name, removal_list):
```

清理规则:

· 移除冗余标识: _电信、高清、频道、-HD等
· 统一后缀: 移除多余的HD、台等后缀
· 繁简转换: 统一转换为简体中文

智能分类系统

脚本支持50+个分类，包括：

主频道分类:

· 🌐 央视频道 (CCTV系列)
· 📡 卫视频道 (各省卫视)

地方台分类 (27个省份):

· ☘️ 北京频道、上海频道、广东频道等

定制频道分类 (23个类别):

· 📰 新闻频道、🎬 电影频道、⚽ 体育频道等
· 🐯 虎牙直播、🐬 斗鱼直播等直播平台
· 🇭🇰 香港频道、🇲🇴 澳门频道等特殊区域

去重机制

```python
def check_url_existence(data_list, url):
def get_url_hash(url):
```

· URL哈希去重: 使用MD5确保同一URL不被重复收录
· 分类内去重: 每个分类内部进行URL存在性检查
· 黑名单过滤: 过滤已知无效或恶意URL
· 协议过滤: 跳过UDP/RTSP等不稳定协议

3. 质量控制

黑名单系统

· 自动黑名单: 从处理过程中自动收集无效URL
· 手工黑名单: 人工维护的永久黑名单
· 协议黑名单: 过滤tvbus://、/udp/等不稳定协议

白名单优化

```python
# 只保留响应时间<2秒的高速源
if response_time < 2000:
```

· 性能筛选: 基于响应时间筛选高质量源
· 速度优先: 确保用户体验流畅

手工区维护

· 优质源保障: 手工维护央视、卫视等关键频道
· 特殊源收录: AKTV等特殊源的专门处理
· 质量把控: 确保核心频道的稳定性和清晰度

4. 输出生成

多版本输出

完整版 (full.txt):

· 包含所有分类的完整频道列表
· 适合需要全面频道覆盖的用户

精简版 (lite.txt):

· 只包含央视和卫视等主要频道
· 文件体积小，加载速度快

定制版 (custom.txt):

· 主要频道 + 更新信息
· 平衡了全面性和文件大小

其他源 (others.txt):

· 未被分类的"漏网之鱼"
· 用于质量检查和后续优化

M3U格式生成

```python
def make_m3u(txt_file, m3u_file):
```

· 自动转换: 从TXT格式自动生成标准M3U格式
· Logo集成: 自动匹配频道Logo
· 分组信息: 保留原始分类分组信息
· EPG支持: 集成电子节目指南链接

5. 特色功能

智能名称处理

```python
def process_name_string(input_str):
```

· CCTV标准化: 统一CCTV频道命名格式
· 卫视清理: 移除卫视名称中的冗余信息
· 4K/8K识别: 智能识别和处理超高清频道

体育赛事日期标准化

```python
def normalize_date_to_md(text):
```

统一各种日期格式为月-日标准格式，便于排序和识别。

动态更新信息

· 时间戳: 包含北京时间的精确处理时间
· 推荐频道: 随机推荐优质频道
· 使用说明: 包含使用规范和注意事项

⚙️ 配置说明

核心配置参数

```python
# 网络请求配置
REQUEST_TIMEOUT = 10        # 请求超时时间(秒)
REQUEST_RETRIES = 3         # 重试次数
REQUEST_BACKOFF_FACTOR = 1.5 # 退避系数

# 清理规则
REMOVAL_LIST = [...]        # 需要移除的频道名称关键词

# 协议过滤
URL_PATTERNS_TO_SKIP = ['tvbus://', '/udp/', 'rtsp://', 'rtp://']
```

路径配置

所有输入输出路径均采用硬编码，确保部署一致性。

📊 监控与统计

实时进度显示

· 🌐 处理URL: 显示当前处理的源
· ✅ 处理完成: 显示有效频道数量
· 📊 分类统计: 各分类频道数量

最终统计报告

```python
def generate_statistics(data_containers, timestart):
```

· 时间统计: 开始时间、结束时间、执行时长
· 数量统计: 各主要分类的频道数量
· 文件检查: 所有输出文件的完整性验证
· 状态汇总: 成功/失败状态提示

🚀 使用流程

执行步骤

1. 初始化: 创建输出目录，加载配置
2. 数据加载: 读取字典数据、黑名单、白名单
3. 源处理: 遍历URL列表，获取并处理直播源
4. 分类分发: 将频道分发到50+个分类中
5. 质量控制: 应用黑名单、去重、标准化
6. 文件生成: 生成4个TXT版本和3个M3U版本
7. 统计报告: 生成处理统计和验证报告

输出文件说明

· full.txt: 完整频道列表，包含所有分类
· lite.txt: 精简版，只包含主要频道
· custom.txt: 定制版，主要频道+更新信息
· others.txt: 未分类频道，用于质量检查
· 对应.m3u: 各版本的M3U格式文件

🔍 技术特点

优势

1. 全面性: 支持50+个分类，覆盖各种频道类型
2. 智能性: 自动分类、去重、标准化
3. 稳定性: 完善的错误处理和重试机制
4. 灵活性: 多版本输出满足不同需求
5. 可维护性: 模块化设计，便于扩展和维护

适用场景

· 📺 个人电视直播应用
· 🏢 企业内部的电视频道服务
· 🔬 直播源质量分析和研究
· 🛠️ 其他基于直播源的开发项目

📝 注意事项

1. 网络依赖: 需要稳定的网络连接获取源数据
2. 资源消耗: 处理大量数据时需要足够的内存
3. 时效性: 直播源具有时效性，需要定期更新
4. 合法性: 请确保使用合法的直播源，遵守相关法律法规

这个脚本是一个功能完整、设计专业的直播源处理系统，适合需要高质量电视直播频道管理的各种应用场景。